<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/public.css">
    <style>
        .Turn-out ul li{
            height:49px;
            border-bottom:1px solid #c6c6c6;
            line-height:49px;
            font-size:19px;
            padding-left:38px;
            color:#000000;
        }
        .Turn-out .Turn-out-Crumbs{
            padding-left:28px;
            font-size:20px;
            color:#000000;
        }
        
        .Turn-out ul li label{
            display:block;
            width:174px;
            float:left;
        }
        .Turn-out ul li input{
            width:195px;
            height:29px;
            border:1px solid #c6c6c6;
        }
        .Turn-out .Turn-out-btn {
            width:336px;
            height:65px;
            display:block;
            background-color:#2ebddb;
            margin:0 auto;
            font-size:30px;
            color:white;
            margin-top:66px;
        }
    </style>
   </head>
   <body>
      <div class="Business-head">
            <span class="Business-center">商务中心</span>
            <p><span id="username"></span><a href="javascript:void(0)" id="Log-out">退出登入</a></p>
      </div>   
      <div class="A-coin">
        <div class="A-coin-left">
            <div class="A-coin-list" id="A-coin-list">
                <a href="./yibizhuanchu.html">一币转出</a>
                <a href="./yibijiaoyishichang.html">一币交易市场</a>
                <a href="./yibirengoumingxi.html">一币认购明细</a>
                <a href="./baodanbizhuanchu.html">报单币转出</a>
                <a href="./baodanbichongzhi.html">报单币充值</a>
                <a href="./VIPchongzhiguanli.html">充值币管理</a>
                <a href="./VIPchongzhimingxi.html">VIP充值明细</a>
                <a href="./beiyongbaodanbimingxi.html">备用报单币明细</a>
            </div>
        </div>
        <div class="A-coin-right">
            <div class="A-coin-bg">
                <h2>数据面板</h2>
                <var>Dashboard</var>
                <div>
                    <i class="Money-pot">钱罐余额</i>
                    <p id="p-1">
                      
                    </p>
                </div>
                <div>
                    <i class="Rechargeable-coin">充值币余额</i>
                    <p id="p-2">
                      
                    </p>
                </div>
                <div>
                    <i class="Recharge-number">累计充值数</i>
                    <p id="p-3">
                      
                    </p>
                </div>
                <div>
                    <i class="Rechargeable-coins">已用充值币</i>
                    <p id="p-4">
                      
                    </p>
                </div>
                <div>
                    <i class="Currency-declaration">备用报单币</i>
                    <p id="p-5">
                     
                    </p>
                </div>
            </div>
            <div class="Turn-out">
                <ul>
                    <li class="Turn-out-Crumbs">验证vip权限</li>
                    <li><label>用户名</label><span id="name"></span></li>
                    <li><label>二级密码</label><input type="password" id="pwd"/></li>
                    <li style='display:none;'><label>法人手机号</label><span id="mobile"></span><input type="hidden" name="toUserName" value="${farenUser.username}"></li>
                    <li style='display:none;'><label>手机号码</label><span id="mobile-code">${gcuser.call}</span><input type="hidden" name="toUserName" value="${gcuser.username}"></li>
                    <li><label>输入手机号</label><input type="text" id="inputCall"/> </li>
                    <li><label>手机验证码</label><input type="text" id="smsCode"/><input type="button" id="btn-code" style="width:136px; border:none;height:26px; font-size:12px;color:white;background:#ea765d;margin-left:30px; position:relative;top:-2px" value="免费获取验证码"></li>
                </ul>
                    <input type="button" class="Turn-out-btn" id="Turn-out-btn" value="验证" style="cursor:pointer;">
            </div>
        </div>
      </div>
      <script src="js/jq.js"></script>
      <script src="js/public.js"></script>
      <script>
        var username="";
        function getCookie(name){
            var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
            if(arr=document.cookie.match(reg))
            return unescape(arr[2]);
            else
            return null;
        }
        
        ajax('get','/vip/'+getCookie('name'),null,function(data){
                console.log(data)
                $$('name').innerHTML=data.farenUser.username;
                $$('mobile').innerHTML=data.farenUser.call+'&nbsp;&nbsp;&nbsp;'+data.farenUser.name;
                $$('mobile-code').innerHTML=data.gcuser.call;
                $('#mobile').next().val(data.farenUser.username);
                $('#mobile-code').next().val(data.gcuser.username)
                if(data.gcuser.vip == 2){
                  $$('mobile').parentNode.style.display='block';
                  username=data.farenUser.username;
                }else{
                  $$('mobile-code').parentNode.style.display='block';
                  username=data.gcuser.username;
                }
        })
        $$('btn-code').onclick=function(){
            if($$('pwd').value==""){
                alert('二级密码不能为空')
                $$('pwd').focus()
                return ;
            }
         
            if($('#inputCall').val()==""){
                alert('输入手机号不能为空')
                $$('inputCall').focus()
                return ;
            }
            settime(this);
   
            //手机验证吗
            ajax('get',"/vip/vipsmsother?op=23&other=1&toUserName="+username+"&inputCall="+$$('inputCall').value.trim(),null,function(response) {
                if (response.erroCodeNum == 2) {
                    alert('输入的手机号与预留手机号不一致！');
                    return ;
                }
                if(response.erroCodeNum==2000){
                     alert("手机验证码发送成功");
                     return ;
                }
                if (response.erroCodeNum != 0) {
                    alert("手机验证码发送失败");
                    return ;
                }
               
            });
        }
        
        $$('Turn-out-btn').onclick=function(){
            if($$('pwd').value==""){
                alert('二级密码不能为空')
                $$('pwd').focus()
                return ;
            }
         
            if($('#inputCall').val()==""){
                alert('输入手机号不能为空')
                $$('inputCall').focus()
                return ;
            } 
            if($$('smsCode').value==""){
                alert('手机验证码不能为空')
                $$('smsCode').focus();
                return ;
            }
            var obj={'toUserName':$$('name').value,'pa3':$$('pwd').value,'inputCall':$$('inputCall').value,'smsCode':$$('smsCode').value};
            ajax('get','/vip/addviptoken',obj,function(data){
                if(data.erroCodeNum==2000){
                    location.href='./'+getCookie('page')+'.html';
                }else{
                    alert(data.erroDescrip);
                }
            })
        }   
      </script>
   </body>
</html>